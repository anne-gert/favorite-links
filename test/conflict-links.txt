!title CONFLICT TEST

!text
<p>
Test file om 3-way update te testen. The StatusLine is made to be always visible.
</p>
<p>
Below are links to open this page multiple times with different config-names.
This makes it different copies of the same contents. Changing while saving is
disabled (by making the password invalid) will create conflict situations.
</p>
<p>
There is also a checkbox to generate updates.
</p>
<hr>
!endtext

!script
// Display StatusLine
let ctl = document.getElementById('StatusLine');
ctl.style.color = '#FFFF00';
!endscript

!script
{
	let LogTest = CreateLogger('all');
	let myConfigName = UrlResolver.getLoadOverrideConfigName() || UrlResolver.getLoadConfigName() || 'none';
	if (!myConfigName.match(/conflict-config/)) {
		// Copy LoadOptions and SaveOptions
		let extraConfigs = [];
		for (let i = 1; i <= 2; ++i) {
			let configName = 'conflict-config-' + i;
			LogTest.important('Set Load/SaveOptions for Config ' + configName);
			let ds;
			let ur = CreateUrlResolver('?links=' + configName, () => ds);
			ds = CreateData(() => ur);
			let loadOptions = UrlResolver.getLoadOverrideOptions() || UrlResolver.getLoadOptions();
			ur.setLoadOptions(loadOptions);
			ds.writeLoadOptions(loadOptions);
			let saveOptions = UrlResolver.getSaveOptions() + '=incorrect';
			ur.setSaveOptions(saveOptions);
			ds.writeSaveOptions(saveOptions);
			extraConfigs.push(ur);
		}
		// Add onunload listener for cleanup
		addEventListener('beforeunload', event => {
			LogTest.important('Cleanup extraConfigs');
			for (let i = 0; i < extraConfigs.length; ++i) {
				let ur = extraConfigs[i];
				LogTest.log('Cleanup Config ' + ur.getLoadConfigName());
				ur.setLoadOptions('');
				LogTest.log('Cleanup Config ' + ur.getSaveConfigName());
				ur.setSaveOptions('');
			}
		});
	} else {
		LogTest.important('Do not change configs in \'' + myConfigName + '\'');
	}
}
!endscript

_
    Clone Pages
	Clone Config-1 url=favorites.html?links=conflict-config-1
	Clone Config-2 url=favorites.html?links=conflict-config-2
    Checkbox
        [x] A
        [ ] B
        [ ] C


